<template>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

  <svg style="width:100%;height:100%;" viewBox="0 0 1440 113" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect x="-0.5" y="-0.5" width="1441" height="45" fill="white" stroke="#CBD2DA"/>
    <path d="M1292 0H1440V44H1305L1292 0Z" fill="#FFE615"/>
    <path d="M1322.49 17.5615V21.3213H1326.24V17.5615H1327.84V26.5713H1326.24V22.8594H1322.49V26.5713H1320.89V17.5615H1322.49ZM1331.02 17.5615V22.6338C1331.02 23.6797 1331.23 24.3154 1331.59 24.6846C1331.96 25.0537 1332.5 25.1699 1333.13 25.1699C1333.78 25.1699 1334.31 25.0537 1334.67 24.6846C1335.03 24.3154 1335.24 23.6797 1335.24 22.6338V17.5615H1336.84V23.0918C1336.84 24.1514 1336.6 24.9033 1336.21 25.4434C1335.83 25.9834 1335.31 26.291 1334.77 26.4756C1334.23 26.6602 1333.67 26.708 1333.21 26.708H1333.06C1332.59 26.708 1332.04 26.6602 1331.5 26.4756C1330.95 26.291 1330.44 25.9834 1330.06 25.4434C1329.67 24.9033 1329.42 24.1514 1329.42 23.0918V17.5615H1331.02ZM1340.02 17.5615V25.0332H1343.77V26.5713H1338.42V17.5615H1340.02ZM1344.94 17.5615H1347.52C1348.12 17.5615 1348.76 17.623 1349.36 17.8076C1349.96 17.9922 1350.5 18.2861 1350.91 18.7441C1351.31 19.209 1351.55 19.8311 1351.55 20.6719C1351.55 21.7451 1351.06 22.4902 1350.31 22.9756C1349.56 23.4609 1348.55 23.6729 1347.52 23.6729H1346.54V26.5713H1344.94V17.5615ZM1346.54 22.1348H1347.55C1348.48 22.1348 1349.08 21.9844 1349.45 21.7109C1349.82 21.4443 1349.95 21.0684 1349.95 20.624C1349.95 20.166 1349.82 19.79 1349.45 19.5166C1349.08 19.25 1348.48 19.0996 1347.55 19.0996H1346.54V22.1348ZM1358.14 26.5713H1356.54V17.5615H1358.14L1361.89 23.5566V17.5615H1363.49V26.5713H1361.89L1358.14 20.583V26.5713ZM1364.79 22.0596C1364.79 20.7471 1365.23 19.5918 1366 18.7578C1366.76 17.9238 1367.85 17.4248 1369.14 17.4248C1370.42 17.4248 1371.49 17.9238 1372.23 18.7578C1372.97 19.5918 1373.4 20.7471 1373.4 22.0596C1373.4 23.3721 1372.96 24.5273 1372.19 25.3613C1371.43 26.1953 1370.35 26.708 1369.06 26.708C1367.78 26.708 1366.7 26.1953 1365.96 25.3613C1365.22 24.5273 1364.79 23.3721 1364.79 22.0596ZM1366.39 21.9912C1366.39 22.8936 1366.63 23.6934 1367.09 24.2607C1367.55 24.8281 1368.23 25.1699 1369.14 25.1699C1370.01 25.1699 1370.67 24.8555 1371.12 24.3086C1371.56 23.7686 1371.8 23.0098 1371.8 22.1279C1371.8 21.0957 1371.45 20.2959 1370.93 19.7627C1370.42 19.2295 1369.72 18.9561 1369.04 18.9561C1368.38 18.9561 1367.71 19.2158 1367.22 19.7285C1366.72 20.2412 1366.39 21 1366.39 21.9912ZM1374.7 17.5615H1377.69C1379.16 17.5615 1380.35 18.0674 1381.19 18.8809C1382.02 19.6943 1382.48 20.8223 1382.48 22.0527C1382.48 23.1738 1382.1 24.3018 1381.33 25.1494C1380.55 25.9971 1379.37 26.5713 1377.76 26.5713H1374.7V17.5615ZM1376.3 25.04H1377.5C1378.76 25.04 1379.59 24.6162 1380.11 24.0352C1380.62 23.4541 1380.81 22.709 1380.81 22.0596C1380.81 21.3145 1380.53 20.5693 1379.95 20.0156C1379.38 19.4688 1378.52 19.0996 1377.37 19.0996H1376.3V25.04ZM1385.38 17.5615V26.5713H1383.78V17.5615H1385.38ZM1393.6 19.1885L1393.55 19.2158C1393.2 19.1064 1392.8 19.0312 1392.45 18.9902C1392.09 18.9492 1391.77 18.9355 1391.58 18.9355C1390.79 18.9355 1389.97 19.1816 1389.36 19.6807C1388.76 20.1797 1388.35 20.9385 1388.35 21.9707C1388.35 22.9482 1388.63 23.748 1389.12 24.3018C1389.61 24.8555 1390.31 25.1699 1391.13 25.1699C1391.84 25.1699 1392.44 24.9375 1392.88 24.5205V22.9551H1391.22V21.4717H1394.35L1394.4 21.5264V26.5713H1393.58L1393.15 26.168C1392.53 26.5166 1391.82 26.708 1391.02 26.708C1389.73 26.708 1388.65 26.2021 1387.89 25.3682C1387.12 24.5342 1386.68 23.3721 1386.68 22.0596C1386.68 20.9111 1387.02 19.749 1387.79 18.874C1388.56 18.0059 1389.77 17.4248 1391.5 17.4248C1391.93 17.4248 1392.3 17.4521 1392.63 17.5C1392.97 17.5547 1393.27 17.623 1393.6 17.7119V19.1885Z" fill="#141010"/>
    <path d="M1415 12.5713C1409.48 12.5713 1405 17.2637 1405 23.0475C1405 28.8346 1409.48 33.5237 1415 33.5237C1420.52 33.5237 1425 28.8346 1425 23.0475C1425 17.2637 1420.52 12.5713 1415 12.5713ZM1415 31.496C1410.54 31.496 1406.94 27.7182 1406.94 23.0475C1406.94 18.3799 1410.54 14.5989 1415 14.5989C1419.46 14.5989 1423.06 18.3784 1423.06 23.0475C1423.06 27.7166 1419.46 31.496 1415 31.496ZM1419.32 20.7157C1419.32 23.5481 1416.4 23.5917 1416.4 24.6385V24.9062C1416.4 25.1861 1416.19 25.4131 1415.92 25.4131H1414.08C1413.81 25.4131 1413.6 25.1861 1413.6 24.9062V24.5404C1413.6 23.0304 1414.69 22.4268 1415.51 21.9418C1416.22 21.5259 1416.66 21.243 1416.66 20.6923C1416.66 19.9638 1415.77 19.4802 1415.05 19.4802C1414.12 19.4802 1413.69 19.9439 1413.08 20.7462C1412.92 20.9625 1412.62 21.0026 1412.41 20.8359L1411.28 19.9447C1411.08 19.7811 1411.03 19.4772 1411.18 19.2535C1412.13 17.7879 1413.34 16.9645 1415.23 16.9645C1417.21 16.9645 1419.32 18.5826 1419.32 20.7157ZM1416.69 27.7787C1416.69 28.757 1415.93 29.5529 1415 29.5529C1414.07 29.5529 1413.31 28.757 1413.31 27.7787C1413.31 26.8004 1414.07 26.0045 1415 26.0045C1415.93 26.0045 1416.69 26.8004 1416.69 27.7787Z" fill="#141010"/>
    <path d="M28 0H29L42.5 44H41.5L28 0Z" fill="#CBD2DA"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0252 11.5641C8.9737 12.0256 9.0252 12.4872 9.17971 13.0513C9.69475 12.0256 10.3643 11.2564 11.3944 10.5385C13.506 9.25641 12.579 7 12.579 7C12.4759 7.61538 11.6004 8.23077 11.6004 8.23077C11.5461 8.26682 11.4712 8.31062 11.3812 8.36332C10.7029 8.76037 9.1616 9.66263 9.0252 11.5641ZM25.4333 22.2877C25.8591 22.1211 26.316 21.9423 27 22.4872L26.897 29.718C26.6216 29.718 26.3312 29.6581 25.9999 29.5898C25.4638 29.4794 24.8208 29.3469 23.9613 29.4103C22.7252 29.5128 22.0041 30.3846 21.6436 31.3077C21.4376 31.7692 21.2316 32.8974 21.2831 32.9487C21.3346 33.1026 24.0643 34.6923 26.897 34.6923V37C24.0128 37 21.3346 33.9744 20.9741 33.0513C20.8711 32.6923 20.768 31.9231 20.768 31.718C20.768 31.3116 20.7298 30.8672 20.6882 30.3846C20.6616 30.0755 20.6336 29.7507 20.6135 29.4103C20.5775 28.335 19.8875 27.1847 19.2993 26.2043L19.2993 26.2042L19.2993 26.2042C19.0459 25.7818 18.8115 25.391 18.6564 25.0513C18.5128 24.801 18.3441 24.3014 18.2027 23.8828L18.2027 23.8828L18.2026 23.8825C18.1413 23.7008 18.0851 23.5344 18.0383 23.4103C17.6263 22.2821 17.0083 18.7949 16.9568 18.4872C15.3602 10.5898 14.8966 9.71796 14.8966 9.71796C14.8966 9.71796 15.4632 9.46155 16.6993 12.6923C17.0083 13.4616 17.4203 14.7949 17.6263 15.6667C17.8838 16.641 18.1414 17.6667 18.3989 18.6923C18.5221 19.1831 18.6217 19.6856 18.7204 20.183L18.7204 20.183L18.7204 20.183L18.7204 20.183L18.7204 20.183L18.7204 20.183C18.8278 20.7251 18.9341 21.2611 19.0684 21.7692C19.2665 22.5583 19.6433 23.2525 20.0211 23.9488C20.4291 24.7006 20.8384 25.4548 21.0256 26.3333C21.1801 27.2564 21.7466 27.8205 22.3647 28.2308C23.6523 29.1539 25.9184 27.9744 26.2274 26.6923C26.2789 26.5385 26.2789 26.1282 26.2789 25.9744C26.1759 25.2564 25.9184 24.7949 25.2489 24.4872C25.227 24.4763 25.1841 24.4561 25.1257 24.4286C24.9095 24.3268 24.4807 24.1249 24.1158 23.9231C23.6007 23.6154 22.4677 22.1282 23.2917 21.718C23.5125 21.608 23.7629 21.8074 24.035 22.024C24.2706 22.2116 24.5224 22.4121 24.7853 22.4359C25.0103 22.4531 25.2178 22.372 25.4333 22.2877ZM12.4162 17.8349C13.4227 16.6161 14.5223 15.2845 14.5876 14.1795C14.7936 14.8974 15.2056 16.641 14.0726 18.2308C13.094 19.6154 12.0124 21.5641 11.7549 23.4102C11.6519 24.3846 11.7034 25.3077 11.7549 26.1282C11.7584 26.1982 11.7624 26.2709 11.7665 26.3457C11.8227 27.3669 11.9011 28.7926 11.0853 29.4615C10.8175 29.6461 10.8216 29.6256 10.867 29.4C10.9349 29.0615 11.0956 28.2615 10.5703 27C10.0553 25.8205 9.59173 24.5385 9.95226 22.4872C10.0553 21.7692 10.5703 20.4872 10.9823 19.7692C11.2841 19.2058 11.8346 18.5392 12.4162 17.8349L12.4162 17.8349L12.4162 17.8349L12.4162 17.8349L12.4162 17.8349ZM15.1541 19.0513C15.1541 19.0513 15.4632 20.4359 14.2271 23.9231C11.7504 31.0029 14.8196 33.116 17.1387 34.7128C17.8097 35.1748 18.4179 35.5936 18.8109 36.0769C18.8109 36.0769 19.4805 35.1538 16.7508 32.1795C15.7722 31.1026 14.8451 28.6923 15.6177 25.2564C16.7508 20.282 15.1541 19.0513 15.1541 19.0513ZM14.1241 10.9487C14.1279 10.9564 14.1328 10.9655 14.1385 10.9761C14.2832 11.2449 14.9251 12.4376 11.7034 15.1026C8.35565 17.8205 9.43723 19.7692 9.43723 19.7692C9.43723 19.7692 5.88347 17.8205 9.95227 14.3846C14.0211 11 13.197 10.2821 13.197 10.2821C13.197 10.2821 13.815 10.3333 14.1241 10.9487ZM19.1297 12.7601C18.8829 12.3649 18.6842 12.0468 18.4504 12.0257C23.8583 10.7949 23.7038 14.8462 23.3432 15.8718C22.8797 16.0257 22.5192 15.2564 22.9827 15C22.8184 14.64 22.3393 14.5724 21.7599 14.4906C21.4314 14.4443 21.0706 14.3934 20.7165 14.2821C19.93 14.0411 19.4811 13.3225 19.1297 12.7601ZM20.3431 12.7436C20.3045 12.7436 20.2788 12.7436 20.253 12.7949C19.841 14.1282 22.4677 14.5385 22.2617 13C22.1052 13 21.9018 13.076 21.7009 13.151C21.3068 13.2982 20.9226 13.4416 20.9226 13C20.9226 12.7459 21.1399 12.7476 21.342 12.7491C21.4663 12.75 21.5848 12.7509 21.6436 12.6923C21.7466 12.5898 21.7981 12.3333 21.6951 12.2821C21.4891 12.1795 21.2831 12.1795 21.0771 12.2308C20.8814 12.2697 20.7453 12.4271 20.6234 12.5679C20.5848 12.6124 20.5477 12.6553 20.5105 12.6923C20.4333 12.7436 20.3818 12.7436 20.3431 12.7436Z" fill="#141010"/>
    <path d="M56.7236 28.1758H54.3154L50.2637 16.416H52.4434L55.5195 25.3457L58.5957 16.416H60.7754L56.7236 28.1758ZM63.9746 15.2734H64.2383V28H62.1816V15.4492L63.9746 15.2734ZM74.3545 26.4531L73.4229 28.1758C72.7549 28.1758 72.0518 27.9648 71.375 27.2178C71.0146 27.4902 70.6982 27.7275 70.3203 27.8945C69.9336 28.0703 69.5029 28.1758 68.9141 28.1758C68.2812 28.1758 67.5342 28.0527 66.9453 27.6309C66.3477 27.209 65.9082 26.4883 65.9082 25.2666C65.9082 24.4668 66.1016 23.8252 66.5938 23.3945C67.0859 22.9639 67.8857 22.7266 69.1074 22.7266C69.5996 22.7266 70.1709 22.7266 70.9795 22.7969V22.3398C70.9795 21.707 70.7773 21.2676 70.4521 21.0039C70.127 20.7402 69.6875 20.6348 69.1953 20.6348C68.4131 20.6348 67.4902 20.916 66.752 21.2588L66.2686 19.4658C67.2266 19.0088 68.4482 18.6924 69.5996 18.6924C70.5049 18.6924 71.3486 18.8857 71.9814 19.3604C72.6055 19.835 73.001 20.582 73.001 21.6982V25.0908C73.001 25.5215 73.1416 25.8203 73.3877 26.0312C73.625 26.2422 73.959 26.374 74.3545 26.4531ZM70.9707 24.8623V24.3086C70.0127 24.3086 69.2656 24.291 68.7559 24.4141C68.2461 24.5371 67.9648 24.8008 67.9648 25.3369C67.9648 26.084 68.501 26.4971 69.248 26.4971C69.5029 26.4971 69.9336 26.4443 70.3027 26.2158C70.6719 25.9873 70.9707 25.5742 70.9707 24.8623ZM83.4248 26.4531L82.4932 28.1758C81.8252 28.1758 81.1221 27.9648 80.4453 27.2178C80.085 27.4902 79.7686 27.7275 79.3906 27.8945C79.0039 28.0703 78.5732 28.1758 77.9844 28.1758C77.3516 28.1758 76.6045 28.0527 76.0156 27.6309C75.418 27.209 74.9785 26.4883 74.9785 25.2666C74.9785 24.4668 75.1719 23.8252 75.6641 23.3945C76.1562 22.9639 76.9561 22.7266 78.1777 22.7266C78.6699 22.7266 79.2412 22.7266 80.0498 22.7969V22.3398C80.0498 21.707 79.8477 21.2676 79.5225 21.0039C79.1973 20.7402 78.7578 20.6348 78.2656 20.6348C77.4834 20.6348 76.5605 20.916 75.8223 21.2588L75.3389 19.4658C76.2969 19.0088 77.5186 18.6924 78.6699 18.6924C79.5752 18.6924 80.4189 18.8857 81.0518 19.3604C81.6758 19.835 82.0713 20.582 82.0713 21.6982V25.0908C82.0713 25.5215 82.2119 25.8203 82.458 26.0312C82.6953 26.2422 83.0293 26.374 83.4248 26.4531ZM80.041 24.8623V24.3086C79.083 24.3086 78.3359 24.291 77.8262 24.4141C77.3164 24.5371 77.0352 24.8008 77.0352 25.3369C77.0352 26.084 77.5713 26.4971 78.3184 26.4971C78.5732 26.4971 79.0039 26.4443 79.373 26.2158C79.7422 25.9873 80.041 25.5742 80.041 24.8623ZM86.4043 18.877L86.6064 19.5889C87.4502 19.0264 88.4961 18.7012 89.5156 18.7012C90.3857 18.7012 91.2207 18.9385 91.8271 19.4658C92.4336 19.9932 92.8291 20.793 92.8291 21.9443V28H90.7725V22.5508C90.7725 21.874 90.5264 21.3994 90.1484 21.1006C89.7705 20.8018 89.2607 20.6787 88.707 20.6787C88.0039 20.6787 87.2832 20.8896 86.7207 21.2412V28H84.6641V18.877H86.4043ZM101.126 28L100.757 27.3145C100.054 27.8418 99.3154 28.1758 98.3047 28.1758C96.9951 28.1758 96.0195 27.6484 95.3779 26.8398C94.7363 26.0312 94.4199 24.9414 94.4199 23.8164C94.4199 22.0938 94.9385 20.8105 95.7998 19.958C96.6611 19.1143 97.874 18.7012 99.2803 18.7012C99.6934 18.7012 100.142 18.7275 100.625 18.7891V15.4492L102.365 15.2734H102.682V28H101.126ZM100.625 25.6357V20.8105C100.106 20.6787 99.5791 20.6172 99.166 20.6172C98.3838 20.6172 97.7246 20.8457 97.2676 21.3203C96.8105 21.7949 96.5469 22.498 96.5469 23.4473C96.5469 24.1416 96.7402 24.8184 97.1094 25.3369C97.4785 25.8555 98.0234 26.1982 98.7529 26.1982C99.377 26.1982 100.071 25.9785 100.625 25.6357ZM111.646 25.6357V27.6309C110.838 28.0264 109.836 28.1758 109.054 28.1758C107.788 28.1758 106.619 27.7803 105.758 26.998C104.896 26.2158 104.352 25.0205 104.352 23.4385C104.352 21.9004 104.861 20.7227 105.635 19.9141C106.399 19.1143 107.428 18.7012 108.456 18.7012C108.746 18.7012 109.265 18.7363 109.801 18.9209C110.337 19.1055 110.926 19.457 111.365 20.0635C111.805 20.6699 112.112 21.5664 112.112 22.832V24.2031H106.575C106.742 24.9414 107.12 25.4424 107.612 25.7588C108.096 26.0752 108.685 26.207 109.273 26.207C110.047 26.207 110.864 25.9873 111.567 25.6094L111.646 25.6357ZM106.549 22.5771H110.231C110.188 21.9092 109.95 21.4346 109.634 21.1182C109.317 20.8105 108.913 20.6787 108.518 20.6787C108.096 20.6787 107.665 20.8193 107.313 21.127C106.953 21.4434 106.681 21.918 106.549 22.5771ZM119.829 19.0615L119.179 21.1445C118.66 20.8281 118.15 20.6875 117.632 20.6875C116.964 20.6875 116.349 20.9336 115.795 21.3555V28H113.738V18.877H115.479L115.689 19.624C116.322 19.0879 117.096 18.7012 118.01 18.7012C118.256 18.7012 118.599 18.7188 118.933 18.7803C119.267 18.8418 119.592 18.9297 119.829 19.0615ZM127.66 25.6357V27.6309C126.852 28.0264 125.85 28.1758 125.067 28.1758C123.802 28.1758 122.633 27.7803 121.771 26.998C120.91 26.2158 120.365 25.0205 120.365 23.4385C120.365 21.9004 120.875 20.7227 121.648 19.9141C122.413 19.1143 123.441 18.7012 124.47 18.7012C124.76 18.7012 125.278 18.7363 125.814 18.9209C126.351 19.1055 126.939 19.457 127.379 20.0635C127.818 20.6699 128.126 21.5664 128.126 22.832V24.2031H122.589C122.756 24.9414 123.134 25.4424 123.626 25.7588C124.109 26.0752 124.698 26.207 125.287 26.207C126.061 26.207 126.878 25.9873 127.581 25.6094L127.66 25.6357ZM122.562 22.5771H126.245C126.201 21.9092 125.964 21.4346 125.647 21.1182C125.331 20.8105 124.927 20.6787 124.531 20.6787C124.109 20.6787 123.679 20.8193 123.327 21.127C122.967 21.4434 122.694 21.918 122.562 22.5771ZM131.492 18.877L131.694 19.5889C132.538 19.0264 133.584 18.7012 134.604 18.7012C135.474 18.7012 136.309 18.9385 136.915 19.4658C137.521 19.9932 137.917 20.793 137.917 21.9443V28H135.86V22.5508C135.86 21.874 135.614 21.3994 135.236 21.1006C134.858 20.8018 134.349 20.6787 133.795 20.6787C133.092 20.6787 132.371 20.8896 131.809 21.2412V28H129.752V18.877H131.492Z" fill="#141010"/>
    <path d="M143 7H143.966L157 37H156.034L143 7Z" fill="#CBD2DA"/>
    <rect y="43" width="1440" height="70" fill="#FFE615"/>
    <path d="M65.0742 64.6836V69.5176H56.4805V93H51.4531V69.5176H42.8594V64.6836H65.0742ZM67.8242 64.834C67.8242 63.9961 68.1465 63.2871 68.6836 62.75C69.2207 62.2129 69.9512 61.8906 70.7891 61.8906C71.627 61.8906 72.3789 62.2129 72.916 62.75C73.4316 63.2871 73.7754 63.9961 73.7754 64.834C73.7754 65.6719 73.4316 66.4023 72.916 66.918C72.3789 67.4551 71.627 67.7773 70.7891 67.7773C69.9512 67.7773 69.2207 67.4551 68.6836 66.918C68.1465 66.4023 67.8242 65.6719 67.8242 64.834ZM73.3242 70.6992V93H68.2969V70.6992H73.3242ZM79.3398 70.6992V65.1133L83.7227 64.6836H84.3672V70.6992H91.0059V75.5332H84.3672V83.1387C84.3672 86.791 84.7754 88.5957 88.2344 88.5957C89.502 88.5957 91.5645 88.2734 92.7676 87.8867L93.6484 92.5918C92.2949 93.0645 89.2441 93.4297 87.6328 93.4297C82.3691 93.4297 79.3398 90.207 79.3398 84.707V75.5332H76.5469V70.6992H79.3398ZM113.844 87.2207V92.0977C111.867 93.0645 109.418 93.4297 107.506 93.4297C104.412 93.4297 101.555 92.4629 99.4492 90.5508C97.3438 88.6387 96.0117 85.7168 96.0117 81.8496C96.0117 78.0898 97.2578 75.2109 99.1484 73.2344C101.018 71.2793 103.531 70.2695 106.045 70.2695C106.754 70.2695 108.021 70.3555 109.332 70.8066C110.643 71.2578 112.082 72.1172 113.156 73.5996C114.23 75.082 114.982 77.2734 114.982 80.3672V83.7188H101.447C101.855 85.5234 102.779 86.748 103.982 87.5215C105.164 88.2949 106.604 88.6172 108.043 88.6172C109.934 88.6172 111.932 88.0801 113.65 87.1562L113.844 87.2207ZM101.383 79.7441H110.385C110.277 78.1113 109.697 76.9512 108.924 76.1777C108.15 75.4258 107.162 75.1035 106.195 75.1035C105.164 75.1035 104.111 75.4473 103.252 76.1992C102.371 76.9727 101.705 78.1328 101.383 79.7441ZM123.77 61.8906H124.414V93H119.387V62.3203L123.77 61.8906Z" fill="#333332"/>
  </svg>


  <div style="height:600px; width:100%" id="map"></div>
</template>

<script>

import "leaflet/dist/leaflet.css"
import leaflet from "leaflet"
import { onBeforeUnmount } from 'vue'

import { visualiseObservation } from '@/components/observation'
import { observationIcon, mobilityHindranceIcon } from '@/components/mapConstants'

import { wktToGeoJSON } from "@terraformer/wkt"
import {visualiseMobilityHindrance} from "@/components/mobility-hindrance";

// We store the reference to the SSE client out here
// so we can access it from other methods
let sseClient;

export default {
  name: "ConnectionState",
  data() {
    return {
      data: [],
      map: {},
      markers: []
    };
  },

  mounted() {
    this.map = leaflet.map("map", {zoomAnimation: false}).setView([50.7747, 4.4852], 8)
    leaflet.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(this.map);

    this.requestMapUpdates();

    this.map.on("moveend", () => {
      sseClient.disconnect()
      this.requestMapUpdates()
    });
  },
  methods: {
    handleMobHind(mobilityHindrance) {

      mobilityHindrance.zones.features.forEach(feature => {
        let marker = leaflet.geoJson(feature, {
          pointToLayer: function(feature, LatLng) {
            return leaflet.marker(LatLng, {icon: mobilityHindranceIcon});
          }
        })

        this.map.addLayer(marker)
        marker.bindPopup(visualiseMobilityHindrance(mobilityHindrance), {autoPan: false})
        this.markers.push(marker)
      })
    },
    handleObservationPoints(observationPoint) {
      function getWktFromString(str){
        const matches = str.split('"');
        return matches[1] ? matches[1].split('>')[1] : str;
      }

      if (observationPoint.observations.lenght !== 0) {
        var geometry = wktToGeoJSON(getWktFromString(observationPoint.wkt));

        var geojsonFeature = {
          "type": "Feature",
          geometry
        };
        
        let marker = leaflet.geoJson(geojsonFeature, {
          pointToLayer: function(feature, LatLng) {
            return leaflet.marker(LatLng, {icon: observationIcon});
          }
        })

        this.map.addLayer(marker)
        marker.bindPopup(visualiseObservation(observationPoint.observations), {autoPan: false})
        this.markers.push(marker)
      }
    },

    requestMapUpdates() {
      this.markers.forEach(marker => this.map.removeLayer(marker))
      sseClient = this.$sse.create({
          url: 'http://localhost:3000/sse?bounds='+ JSON.stringify(this.map.getBounds()) + "&zoom=" + this.map._zoom,
          format: 'json',
          withCredentials: false,
          polyfill: true,
        });
      
      sseClient.connect().then(() => {
        
      })
      .catch((err) => {
        console.error('Failed to connect to server', err);
      });

      sseClient.on('error', (e) => {
        console.error('lost connection or failed to parse!', e);
      });
      sseClient.on('mobility-hindrance', this.handleMobHind)
      sseClient.on('observation-point', this.handleObservationPoints)
    }
  },
  setup() {
    onBeforeUnmount(() => {
      // Make sure to close the connection with the events server
      // when the component is destroyed, or we'll have ghost connections!
      sseClient.disconnect();
      // Alternatively, we could have added the `sse: { cleanup: true }` option to our component,
      // and the SSEManager would have automatically disconnected during beforeDestroy.
    })
  }

};

</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style>
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid black;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
</style>
